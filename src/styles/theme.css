/* =========================
   Theme tokens
   ========================= */
:root {
  /* colors */
  --fg: #1b1f23;
  --muted: #6b7280;
  --line: #d8dbe0;
  --bg: #f7f8fa;
  --accent: #ffb400;
  --root: #ff6a00;
  --fret: #c9cdd3;
  --board: #f2f3f6;
  --panel: #ffffff;

  --nut: #fffbe6;
  --note: var(--accent);
  --note-micro: #6fa8dc;

  /* layout rhythm */
  --gap: 12px;                                  /* base spacing */
  --gutter: clamp(12px, 3vw, 24px);             /* page side gutters */
  --max-stage: clamp(1100px, 96vw, 1400px);     /* wider fretboard */
  --card-radius: 12px;                           /* matches fretboard */

  /* masonry */
  --card-gap: clamp(8px, 1.6vw, 12px);
  --col-width: clamp(260px, 24vw, 360px);
}

:root[data-theme="dark"] {
  --fg: #e5e7eb;
  --muted: #9ca3af;
  --line: #3a3f46;
  --bg: #101214;
  --panel: #15171a;
  --board: #1a1d21;
  --fret: #2a2f35;
  --accent: #ffc24b;
  --root: #ff7a3d;

  --nut: #dcdcdc;
  --note: var(--accent);
  --note-micro: #89c2ff;
}

/* =========================
   Global base
   ========================= */
* { box-sizing: border-box; }
html, body, #root { height: 100%; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  line-height: 1.35;
  font-size: 14px;
}

/* =========================
   Page layout
   ========================= */
.page {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: var(--bg);
  color: var(--fg);

  .page-header {
    flex: 0 0 auto;
    background: var(--panel);
    border-bottom: 1px solid var(--line);

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 6px 10px;

      a svg { width: 18px !important; height: 18px !important; }
    }

    .app-title { margin: 0; font-size: 1rem; font-weight: 700; }
    .header-right { display: flex; align-items: center; gap: 10px; }
    .toggles { display: flex; align-items: center; gap: 10px; }

    .gh-link {
      display: inline-flex; align-items: center; justify-content: center;
      width: 26px; height: 26px; border-radius: 6px; color: var(--muted); text-decoration: none;
      &:hover { color: var(--fg); background: var(--line); }
      svg { width: 18px; height: 18px; flex: 0 0 18px; }
    }

    .switch { display: flex; gap: 6px; align-items: center; font-size: 12px; color: var(--muted); }
  }

  /* ---- Stage (fretboard) ---- */
  .page-main {
    /* Consistent vertical rhythm */
    margin-top: var(--gap);
    margin-bottom: var(--gap);

    /* Wider than controls, centered with side gutters */
    max-width: var(--max-stage);
    width: 100%;
    padding: 0 var(--gutter);
    margin-left: auto;
    margin-right: auto;

    .stage { width: 100%; }
    .stage-inner { padding: var(--gap); }

    .stage-toolbar {
      position: sticky; top: 0;
      display: flex; justify-content: flex-end; gap: 8px; padding: 8px;
      background: linear-gradient(180deg, rgba(0,0,0,0.06), transparent);
      z-index: 3;
    }

    .fretboard-wrap {
      width: 100%;
      display: grid; place-items: center;
      overflow: auto;
      border: 1px solid var(--line);
      border-radius: var(--card-radius);
      background: var(--panel);
      padding: 8px;

      svg { width: 100%; height: 100%; display: block; }
      &.lefty svg { transform: scaleX(-1); }
    }
  }

  /* =========================
     Controls: same visual width as fretboard,
     rounded box with same outline, masonry inside
     ========================= */
  .page-controls {
    flex: 0 0 auto;

    /* Make container match the *inner* width of the stage (inside gutters) */
    max-width: calc(var(--max-stage) - (var(--gutter) * 2));
    width: 100%;
    margin: 0 auto var(--gap); /* same bottom gap as top */
    padding: var(--gap);       /* equal top & bottom padding */
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: var(--card-radius);

    /* Masonry via multi-columns (cards can have variable heights) */
    column-width: var(--col-width);
    column-gap: var(--card-gap);

    > .panel-sec,
    > section.panel-sec {
      display: block;               /* required for columns */
      break-inside: avoid;          /* keep card intact in a column */
      margin: 0 0 var(--card-gap);
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: var(--panel);

      .sec-header {
        display: flex; justify-content: space-between; align-items: center;
        padding: 8px 10px;
        border: 0; background: transparent; color: var(--fg);
        font-weight: 600; cursor: pointer;

        .chev { color: var(--muted); }
      }
      .sec-body {
        display: grid; gap: 8px;
        padding: 8px 10px;
        min-height: 0;
      }
    }
  }
}

/* =========================
   Section / control atoms
   ========================= */
.panel h1 { font-size: 15px; margin: 0; }

.grid2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }
.tuning-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; }

.field {
  display: flex; flex-direction: column; gap: 4px;
  font-size: 12px;
  > span { color: var(--muted); }
}

select,
input[type="number"],
input[type="range"] {
  padding: 6px 8px;
  border: 1px solid var(--line);
  border-radius: 8px;
  background: transparent;
  color: var(--fg);
  min-height: 32px;
}

.check {
  font-size: 12px;
  color: var(--muted);
  display: flex; gap: 8px; align-items: center;
}

.btn {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid var(--line);
  border-radius: 8px;
  background: transparent;
  color: var(--fg);
  cursor: pointer;
  &:hover { background: color-mix(in oklab, var(--fg) 7%, transparent); }
}
.btn.solid { background: var(--fg); color: var(--panel); border-color: var(--fg); &:hover { opacity: .92; } }

/* Instrument helpers */
.instrument {
  display: grid; gap: 10px; min-width: 0;

  .row-2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; min-width: 0; }

  .strings-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
    gap: 10px; min-width: 0;
  }

  input, select { width: 100%; min-width: 0; box-sizing: border-box; }
  .btn { width: 100%; white-space: normal; line-height: 1.2; }
}

/* Ensure shrink behavior in flex/grid parents */
.section, .panel, .sidebar { min-width: 0; }

/* =========================
   Fretboard visuals
   ========================= */
svg { display: block; width: 100%; height: auto; }

.stringLine { stroke: #8b929a; stroke-width: 1.5; }

.fretLine {
  stroke: var(--fret);
  stroke-width: 1.4;
  &.strong { stroke-width: 1.7; }
  &.micro {
    stroke-width: 1.1;
    stroke-dasharray: 3 7;
    opacity: 0.7;
  }
}

.fretNum { font-size: 11.5px; fill: var(--muted); }
.fretNum.microNum { opacity: 0.55; }

.inlay { fill: #cfd5dd; }
.inlay.big { r: 6.5; }
.inlay.small { fill: var(--line); stroke: var(--fg); stroke-width: 0.6; opacity: 0.9; }
:root[data-theme="dark"] .inlay { fill: #3b4149; }

/* Nut */
.nut { fill: var(--nut); stroke: #000; stroke-width: 2.3; }

/* Note labels */
.noteText { font-size: 10.5px; font-weight: 700; pointer-events: none; fill: #111; }
.noteText.big { font-size: 11.5px; }
:root[data-theme="dark"] .noteText { fill: #0b0b0b; }

/* =========================
   Responsive tweaks
   ========================= */
@media (max-width: 1200px) {
  :root { --col-width: clamp(240px, 30vw, 340px); }
}
@media (max-width: 900px) {
  .grid2 { grid-template-columns: 1fr; }
  .tuning-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .page .page-controls { --col-width: clamp(220px, 44vw, 320px); }
}
@media (max-width: 480px) {
  .tuning-grid { grid-template-columns: 1fr; }
}

/* =========================
   Print
   ========================= */
@media print {
  * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  .page { min-height: auto; }
  .page .page-header, .page .page-controls { display: none !important; }
  .page .page-main { padding: 0; max-width: none; margin: 0; }
}


